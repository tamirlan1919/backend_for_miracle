"use strict";(self.webpackChunknew_backend=self.webpackChunknew_backend||[]).push([[8075],{79211:(K,c,s)=>{s.d(c,{F:()=>O});var e=s(74081),t=s(27279),l=s(52185),a=s(51413),d=s(94486),m=s(22905),r=s(70627),D=s(61020);const O=({displayedFilters:i})=>{const[g,E]=(0,t.useState)(!1),{formatMessage:M}=(0,D.Z)(),_=(0,t.useRef)(),p=()=>{E(S=>!S)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(l.x,{paddingTop:1,paddingBottom:1,children:[(0,e.jsx)(a.z,{variant:"tertiary",ref:_,startIcon:(0,e.jsx)(m.Z,{}),onClick:p,size:"S",children:M({id:"app.utils.filters",defaultMessage:"Filters"})}),g&&(0,e.jsx)(d.J5,{displayedFilters:i,isVisible:g,onToggle:p,source:_})]}),(0,e.jsx)(d.W$,{filtersSchema:i})]})};O.propTypes={displayedFilters:r.arrayOf(r.shape({name:r.string.isRequired,metadatas:r.shape({label:r.string}),fieldSchema:r.shape({type:r.string})})).isRequired}},48075:(K,c,s)=>{s.r(c),s.d(c,{U:()=>he,i:()=>Re});var e=s(74081),t=s(94486),l=s(59461),a=s(91687),d=s(27279),m=s(51413),r=s(84428),D=s(66016),O=s(9465),i=s(83667),g=s(78565),E=s(85898),M=s(2667),_=s(52185),p=s(81565),S=s(37386),oe=s(23851),ae=s(90529),b=s(49899),L=s(3785),x=s(796),Z=s(34041),G=s(51452),k=s(49969),w=s(29206),y=s(61020),N=s(40464),ne=s(51447),le=s(11266),F=s(53098),de=s(79211),j=s(88898),fe=s(9663),Pe=s(18076),u=s(70627),De=s(31430),Oe=s(40505),xe=s(71563),ue=s(70882),q=s(47853);const ge=({onClick:n})=>{const{formatMessage:h}=(0,y.Z)();return(0,e.jsx)(m.z,{onClick:n,startIcon:(0,e.jsx)(j.Z,{}),size:"S",children:h({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})})};ge.propTypes={onClick:u.func.isRequired};const ce=({canDelete:n,headers:h,entriesToDelete:A,onClickDelete:ee,onSelectRow:V,withMainAction:z,withBulkActions:B,rows:R})=>{const{push:C,location:{pathname:Y}}=(0,ne.k6)(),{formatMessage:v}=(0,y.Z)();return(0,e.jsx)(r.p,{children:R.map(o=>{const $=A.findIndex(I=>I===o.id)!==-1;return(0,e.jsxs)(D.Tr,{...(0,t.X7)({fn:()=>C(`${Y}/${o.id}`),condition:B}),children:[z&&(0,e.jsx)(O.Td,{...t.UW,children:(0,e.jsx)(i.C,{"aria-label":v({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,a.g)(o.firstname,o.lastname)}),checked:$,onChange:()=>{V({name:o.id,value:!$})}})}),h.map(({key:I,cellFormatter:Q,name:W,...H})=>(0,e.jsx)(O.Td,{children:typeof Q=="function"?Q(o,{key:I,name:W,formatMessage:v,...H}):(0,e.jsx)(g.Z,{textColor:"neutral800",children:o[W]||"-"})},I)),B&&(0,e.jsx)(O.Td,{children:(0,e.jsxs)(E.k,{justifyContent:"end",children:[(0,e.jsx)(M.h,{onClick:()=>C(`${Y}/${o.id}`),label:v({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,a.g)(o.firstname,o.lastname)}),noBorder:!0,icon:(0,e.jsx)(fe.Z,{})}),n&&(0,e.jsx)(_.x,{paddingLeft:1,...t.UW,children:(0,e.jsx)(M.h,{onClick:()=>ee(o.id),label:v({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,a.g)(o.firstname,o.lastname)}),noBorder:!0,icon:(0,e.jsx)(Pe.Z,{})})})]})})]},o.id)})})};ce.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},ce.propTypes={canDelete:u.bool,entriesToDelete:u.array,headers:u.array.isRequired,onClickDelete:u.func,onSelectRow:u.func,rows:u.array,withBulkActions:u.bool,withMainAction:u.bool};const Ee={firstname:"",lastname:"",email:"",roles:[]},ye=[],Ce=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],ve=q.Ry().shape({firstname:q.Z_().trim().required(t.I0.required),lastname:q.Z_(),email:q.Z_().email(t.I0.email).required(t.I0.required),roles:q.IX().min(1,t.I0.required).required(t.I0.required)}),je={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Me=({onSuccess:n,onToggle:h})=>{const[A,ee]=(0,d.useState)("create"),[V,z]=(0,d.useState)(!1),[B,R]=(0,d.useState)(null),{formatMessage:C}=(0,y.Z)(),Y=(0,t.lm)(),{lockApp:v,unlockApp:o}=(0,t.o1)(),{post:$}=(0,t.kY)(),I=(0,F.p)(ye,async()=>(await s.e(9385).then(s.bind(s,19385))).ROLE_LAYOUT,{combine(P,U){return[...P,U]},defaultValue:[]}),Q=(0,F.p)(Ee,async()=>(await s.e(9385).then(s.bind(s,19385))).FORM_INITIAL_VALUES,{combine(P,U){return{...P,...U}},defaultValue:Ee}),W=(0,F.p)(ue.M,async()=>(await s.e(2916).then(s.bind(s,62916))).MagicLinkEE),H=(0,N.useMutation)(P=>$("/admin/users",P),{async onSuccess({data:P}){R(P.data.registrationToken),await n(),re(),z(!1)},onError(P){throw z(!1),Y({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),P},onSettled(){o()}}),se=C({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),ie=async(P,{setErrors:U})=>{v(),z(!0);try{await H.mutateAsync(P)}catch(X){o(),X?.response?.data?.error.message==="Email already taken"&&U({email:X.response.data.error.message})}},re=()=>{f?ee(f):h()},{buttonSubmitLabel:te,isDisabled:J,next:f}=je[A],Ie=A==="create"?(0,e.jsx)(m.z,{type:"submit",loading:V,children:C(te)}):(0,e.jsx)(m.z,{type:"button",loading:V,onClick:h,children:C(te)});return W?(0,e.jsxs)(p.P,{onClose:h,labelledBy:"title",children:[(0,e.jsx)(S.x,{children:(0,e.jsx)(De.O,{label:se,children:(0,e.jsx)(Oe.$,{isCurrent:!0,children:se})})}),(0,e.jsx)(xe.J9,{enableReinitialize:!0,initialValues:Q,onSubmit:ie,validationSchema:ve,validateOnChange:!1,children:({errors:P,handleChange:U,values:X})=>(0,e.jsxs)(t.l0,{children:[(0,e.jsx)(oe.f,{children:(0,e.jsxs)(E.k,{direction:"column",alignItems:"stretch",gap:6,children:[A!=="create"&&(0,e.jsx)(W,{registrationToken:B}),(0,e.jsxs)(_.x,{children:[(0,e.jsx)(g.Z,{variant:"beta",as:"h2",children:C({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})}),(0,e.jsx)(_.x,{paddingTop:4,children:(0,e.jsx)(E.k,{direction:"column",alignItems:"stretch",gap:1,children:(0,e.jsx)(ae.r,{gap:5,children:Ce.map(_e=>_e.map(T=>(0,e.jsx)(b.P,{...T.size,children:(0,e.jsx)(t.jm,{...T,disabled:J,error:P[T.name],onChange:U,value:X[T.name]})},T.name)))})})})]}),(0,e.jsxs)(_.x,{children:[(0,e.jsx)(g.Z,{variant:"beta",as:"h2",children:C({id:"global.roles",defaultMessage:"User's role"})}),(0,e.jsx)(_.x,{paddingTop:4,children:(0,e.jsxs)(ae.r,{gap:5,children:[(0,e.jsx)(b.P,{col:6,xs:12,children:(0,e.jsx)(ue.S,{disabled:J,error:P.roles,onChange:U,value:X.roles})}),I.map(_e=>_e.map(T=>(0,e.jsx)(b.P,{...T.size,children:(0,e.jsx)(t.jm,{...T,disabled:J,onChange:U,value:X[T.name]})},T.name)))]})})]})]})}),(0,e.jsx)(L.m,{startActions:(0,e.jsx)(m.z,{variant:"tertiary",onClick:h,type:"button",children:C({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:Ie})]})})]}):null};Me.propTypes={onToggle:u.func.isRequired,onSuccess:u.func.isRequired};const me=({pagination:n})=>(0,e.jsx)(_.x,{paddingTop:4,children:(0,e.jsxs)(E.k,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t.v4,{}),(0,e.jsx)(t.tU,{pagination:n})]})});me.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},me.propTypes={pagination:u.shape({page:u.number,pageCount:u.number,pageSize:u.number,total:u.number})};const Ae=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Te=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:n},{formatMessage:h}){return(0,e.jsx)(g.Z,{textColor:"neutral800",children:n.map(A=>h({id:`Settings.permissions.users.${A.code}`,defaultMessage:A.name})).join(`,
`)})}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:n},{formatMessage:h}){return(0,e.jsxs)(E.k,{children:[(0,e.jsx)(t.qb,{isActive:n,variant:n?"success":"danger"}),(0,e.jsx)(g.Z,{textColor:"neutral800",children:h({id:n?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:n?"Active":"Inactive"})})]})}}],pe=["ee","license-limit-info"],he=()=>{const{post:n}=(0,t.kY)(),{formatAPIError:h}=(0,t.So)(),[A,ee]=(0,d.useState)(!1),V=(0,l.v9)(a.s),{allowedActions:{canCreate:z,canDelete:B,canRead:R}}=(0,t.ss)(V.settings.users),C=(0,N.useQueryClient)(),Y=(0,t.lm)(),{formatMessage:v}=(0,y.Z)(),{search:o}=(0,ne.TH)();(0,t.go)();const{users:$,pagination:I,isError:Q,isLoading:W,refetch:H}=(0,le.u)(w.parse(o,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:R}),se=(0,F.p)(ge,async()=>(await s.e(8384).then(s.bind(s,98384))).CreateActionEE),ie=Te.map(f=>({...f,metadatas:{...f.metadatas,label:v(f.metadatas.label)}})),re=v({id:"global.users",defaultMessage:"Users"}),te=()=>{ee(f=>!f)},J=(0,N.useMutation)(async f=>{await n("/admin/users/batch-delete",{ids:f})},{async onSuccess(){await H(),await C.refetchQueries(pe)},onError(f){Y({type:"warning",message:{id:"notification.error",message:h(f),defaultMessage:"An error occured"}})}});return se?(0,e.jsxs)(x.o,{"aria-busy":W,children:[(0,e.jsx)(t.SL,{name:"Users"}),(0,e.jsx)(Z.T,{primaryAction:z&&(0,e.jsx)(se,{onClick:te}),title:re,subtitle:v({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),R&&(0,e.jsx)(G.Z,{startActions:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.m,{label:v({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:re})}),(0,e.jsx)(de.F,{displayedFilters:Ae})]})}),(0,e.jsxs)(k.D,{canRead:R,children:[!R&&(0,e.jsx)(t.ZF,{}),Q&&(0,e.jsx)("div",{children:"TODO: An error occurred"}),R&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.tM,{contentType:"Users",isLoading:W,onConfirmDeleteAll:J.mutateAsync,onConfirmDelete:f=>J.mutateAsync([f]),headers:ie,rows:$,withBulkActions:!0,withMainAction:B,children:(0,e.jsx)(ce,{canDelete:B,headers:ie,rows:$,withBulkActions:!0,withMainAction:B})}),I&&(0,e.jsx)(me,{pagination:I})]})]}),A&&(0,e.jsx)(Me,{onSuccess:async()=>{await H(),await C.refetchQueries(pe)},onToggle:te})]}):null},Le=()=>{const n=(0,F.p)(he,async()=>(await s.e(8862).then(s.bind(s,48862))).UserListPageEE);return n?(0,e.jsx)(n,{}):null},Re=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const n=(0,l.v9)(a.s);return(0,e.jsx)(t.O4,{permissions:n.settings.users.main,children:(0,e.jsx)(Le,{})})}},Symbol.toStringTag,{value:"Module"}))},70882:(K,c,s)=>{s.d(c,{M:()=>_,S:()=>b,a:()=>M});var e=s(74081),t=s(70627),l=s(61020),a=s(53098),d=s(2667),m=s(52870),r=s(33699),D=s(94486),O=s(20049),i=s(30085),g=s(40464),E=s(19003);const M=({children:L,target:x})=>{const Z=(0,D.lm)(),{formatMessage:G}=(0,l.Z)(),{copy:k}=(0,D.VP)(),w=G({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),y=async()=>{await k(x)&&Z({type:"info",message:{id:"notification.link-copied"}})};return(0,e.jsx)(D.Y_,{endAction:(0,e.jsx)(d.h,{label:w,noBorder:!0,icon:(0,e.jsx)(O.Z,{}),onClick:y}),title:x,titleEllipsis:!0,subtitle:L,icon:(0,e.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})};M.propTypes={children:t.oneOfType([t.element,t.string]).isRequired,target:t.string.isRequired};const _=({registrationToken:L})=>{const{formatMessage:x}=(0,l.Z)(),Z=`${window.location.origin}${(0,a.T)()}/auth/register?registrationToken=${L}`;return(0,e.jsx)(M,{target:Z,children:x({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})};_.defaultProps={registrationToken:""},_.propTypes={registrationToken:t.string};const p=(0,E.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,S=E.default.div`
  animation: ${p} 2s infinite linear;
`,oe=()=>(0,e.jsx)(S,{children:(0,e.jsx)(i.Z,{})}),ae=async()=>{const{get:L}=(0,D.tg)(),{data:x}=await L("/admin/roles");return x.data},b=({disabled:L,error:x,onChange:Z,value:G})=>{const{status:k,data:w}=(0,g.useQuery)(["roles"],ae,{staleTime:5e4}),{formatMessage:y}=(0,l.Z)(),N=x?y({id:x,defaultMessage:x}):"",ne=y({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),le=y({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),F=y({id:"app.components.Select.placeholder",defaultMessage:"Select"}),de=k==="loading"?(0,e.jsx)(oe,{}):void 0;return(0,e.jsx)(m.P,{id:"roles",disabled:L,error:N,hint:le,label:ne,name:"roles",onChange:j=>{Z({target:{name:"roles",value:j}})},placeholder:F,multi:!0,startIcon:de,value:G.map(j=>j.toString()),withTags:!0,required:!0,children:(w||[]).map(j=>(0,e.jsx)(r.W,{value:j.id.toString(),children:y({id:`global.${j.code}`,defaultMessage:j.name})},j.id))})};b.defaultProps={disabled:!1,error:void 0},b.propTypes={disabled:t.bool,error:t.string,onChange:t.func.isRequired,value:t.array.isRequired}},11266:(K,c,s)=>{s.d(c,{u:()=>a});var e=s(27279),t=s(94486),l=s(40464);function a(d={},m={}){const{id:r="",...D}=d,{get:O}=(0,t.kY)(),{data:i,isError:g,isLoading:E,refetch:M}=(0,l.useQuery)(["users",r,D],async()=>{const{data:{data:p}}=await O(`/admin/users/${r}`,{params:D});return p},m);return{users:e.useMemo(()=>{let p=[];return i&&("results"in i?Array.isArray(i.results)&&(p=i.results):p=[i]),p},[i]),pagination:e.useMemo(()=>(i&&"pagination"in i)??null,[i]),isLoading:E,isError:g,refetch:M}}},51452:(K,c,s)=>{s.d(c,{Z:()=>l});var e=s(74081),t=s(85898);const l=({startActions:a,endActions:d})=>!a&&!d?null:(0,e.jsxs)(t.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(t.k,{gap:2,wrap:"wrap",children:a}),(0,e.jsx)(t.k,{gap:2,shrink:0,wrap:"wrap",children:d})]})},31430:(K,c,s)=>{s.d(c,{O:()=>O});var e=s(74081),t=s(27279),l=s(19003),a=s(52185),d=s(78565);const m=()=>(0,e.jsx)(a.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,e.jsx)(d.Z,{variant:"pi",textColor:"neutral500",children:"/"})});m.displayName="Divider";var r=s(85898);const D=(0,l.default)(r.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:i})=>`calc(-1*${i.spaces[2]})`};
  }
`,O=({label:i,children:g,...E})=>{const M=t.Children.toArray(g);return(0,e.jsx)(a.x,{"aria-label":i,...E,children:(0,e.jsx)(D,{as:"ol",children:t.Children.map(M,(_,p)=>{const S=M.length>1&&p+1<M.length;return(0,e.jsxs)(r.k,{inline:!0,as:"li",children:[_,S&&(0,e.jsx)(m,{})]})})})})};O.displayName="Breadcrumbs"},40505:(K,c,s)=>{s.d(c,{$:()=>a});var e=s(74081),t=s(52185),l=s(78565);const a=({children:d,isCurrent:m=!1,...r})=>(0,e.jsx)(t.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,e.jsx)(l.Z,{variant:"pi",textColor:"neutral800",fontWeight:m?"bold":"normal","aria-current":m,...r,children:d})});a.displayName="Crumb"},88898:(K,c,s)=>{s.d(c,{Z:()=>l});var e=s(74081);const t=a=>(0,e.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...a,children:[(0,e.jsx)("path",{fill:"#32324D",d:"M0 2.8A.8.8 0 0 1 .8 2h22.4a.8.8 0 0 1 .8.8v2.71a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2.8Z"}),(0,e.jsx)("path",{fill:"#32324D",d:"M1.922 7.991C.197 6.675 0 6.252 0 5.289h23.953c.305 1.363-1.594 2.506-2.297 3.125-1.953 1.363-6.253 4.36-7.828 5.45-1.575 1.09-3.031.455-3.562 0-2.063-1.41-6.62-4.557-8.344-5.873ZM22.8 18H1.2c-.663 0-1.2.471-1.2 1.053v1.894C0 21.529.537 22 1.2 22h21.6c.663 0 1.2-.471 1.2-1.053v-1.894c0-.582-.537-1.053-1.2-1.053Z"}),(0,e.jsx)("path",{fill:"#32324D",d:"M0 9.555v10.972h24V9.554c-2.633 1.95-8.367 6.113-9.96 7.166-1.595 1.052-3.352.438-4.032 0L0 9.555Z"})]}),l=t}}]);
