"use strict";(self.webpackChunknew_backend=self.webpackChunknew_backend||[]).push([[1434],{79211:(R,p,e)=>{e.d(p,{F:()=>L});var t=e(74081),a=e(27279),O=e(52185),c=e(51413),E=e(94486),M=e(22905),u=e(70627),h=e(61020);const L=({displayedFilters:_})=>{const[C,v]=(0,a.useState)(!1),{formatMessage:f}=(0,h.Z)(),x=(0,a.useRef)(),P=()=>{v(A=>!A)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(O.x,{paddingTop:1,paddingBottom:1,children:[(0,t.jsx)(c.z,{variant:"tertiary",ref:x,startIcon:(0,t.jsx)(M.Z,{}),onClick:P,size:"S",children:f({id:"app.utils.filters",defaultMessage:"Filters"})}),C&&(0,t.jsx)(E.J5,{displayedFilters:_,isVisible:C,onToggle:P,source:x})]}),(0,t.jsx)(E.W$,{filtersSchema:_})]})};L.propTypes={displayedFilters:u.arrayOf(u.shape({name:u.string.isRequired,metadatas:u.shape({label:u.string}),fieldSchema:u.shape({type:u.string})})).isRequired}},51434:(R,p,e)=>{e.r(p),e.d(p,{default:()=>me});var t=e(74081),a=e(94486),O=e(59461),c=e(91687),E=e(85898),M=e(78565),u=e(62475),h=e(52185),L=e(90529),_=e(93960),C=e(81565),v=e(37386),f=e(23851),x=e(84428),P=e(66016),A=e(9465),H=e(2667),J=e(71943),X=e(930),G=e(1296),$=e(49969),k=e(796),w=e(34041),q=e(51452),j=e(61020),ee=e(79211),N=e(40464),te=e(51447),se=e(11266),ae=e(31430),ne=e(40505),i=e(70627),ie=e(33866),oe=e(84207),ue=e(27279),ge=e(64797),Ee=e(85811),ce=e(53098),pe=e(15816),Me=e(97442),De=e(13576),Oe=e(87830),Pe=e(47184),he=e(364),Le=e(71563),fe=e(49204),ye=e(47853),Ce=e(75719),Te=e(74919),ve=e(29206),xe=e(98934),Re=e(43433),Ae=e(8175);const re=({canReadAuditLogs:s,canReadUsers:l})=>{const{get:g}=(0,a.kY)(),{search:o}=(0,te.TH)(),m=(0,a.lm)(),[{query:d}]=(0,a.Kx)(),n={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:y=>m({type:"warning",message:y.message})},{users:r,isError:D,isLoading:T}=(0,se.u)({},{...n,enabled:l,staleTime:2*(1e3*60)}),{data:U,isLoading:W,isError:K}=(0,N.useQuery)(["auditLogs",o],async()=>{const{data:y}=await g("/admin/audit-logs",{params:d});return y},{...n,enabled:s});return{auditLogs:U,users:r,isLoading:T||W,hasError:K||D}},V=()=>{const{formatDate:s}=(0,j.Z)();return g=>{const o=(0,ie.Z)(g),m=s(o,{dateStyle:"long"}),d=s(o,{timeStyle:"medium",hourCycle:"h24"});return`${m}, ${d}`}},z={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},S=s=>z[s]||s,B=({actionLabel:s,actionName:l})=>(0,t.jsxs)(E.k,{direction:"column",alignItems:"baseline",gap:1,children:[(0,t.jsx)(M.Z,{textColor:"neutral600",variant:"sigma",children:s}),(0,t.jsx)(M.Z,{textColor:"neutral600",children:l})]});B.propTypes={actionLabel:i.string.isRequired,actionName:i.string.isRequired};const F=({status:s,data:l,formattedDate:g})=>{const{formatMessage:o}=(0,j.Z)();if(s==="loading")return(0,t.jsx)(E.k,{padding:7,justifyContent:"center",alignItems:"center",children:(0,t.jsx)(u.a,{children:"Loading content..."})});const{action:m,user:d,payload:n}=l;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.x,{marginBottom:3,children:(0,t.jsx)(M.Z,{variant:"delta",id:"title",children:o({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"})})}),(0,t.jsxs)(L.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0,children:[(0,t.jsx)(B,{actionLabel:o({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:o({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:S(m)},{model:n?.model})}),(0,t.jsx)(B,{actionLabel:o({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:g}),(0,t.jsx)(B,{actionLabel:o({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:d?.displayName||"-"}),(0,t.jsx)(B,{actionLabel:o({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:d?.id.toString()||"-"})]}),(0,t.jsx)(_.V,{value:JSON.stringify(n,null,2),disabled:!0,label:o({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})})]})};F.defaultProps={data:{}},F.propTypes={status:i.oneOf(["idle","loading","error","success"]).isRequired,data:i.shape({action:i.string,date:i.string,payload:i.object,user:i.object}),formattedDate:i.string.isRequired};const Q=({handleClose:s,logId:l})=>{const{get:g}=(0,a.kY)(),o=(0,a.lm)(),m=async T=>{const{data:U}=await g(`/admin/audit-logs/${T}`);if(!U)throw new Error("Audit log not found");return U},{data:d,status:n}=(0,N.useQuery)(["audit-log",l],()=>m(l),{onError(){o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),s()}}),r=V(),D=d?r(d.date):"";return(0,t.jsxs)(C.P,{onClose:s,labelledBy:"title",children:[(0,t.jsx)(v.x,{children:(0,t.jsx)(ae.O,{label:D,id:"title",children:(0,t.jsx)(ne.$,{isCurrent:!0,children:D})})}),(0,t.jsx)(f.f,{children:(0,t.jsx)(F,{status:n,data:d,formattedDate:D})})]})};Q.propTypes={handleClose:i.func.isRequired,logId:i.string.isRequired};const b=({pagination:s})=>(0,t.jsx)(h.x,{paddingTop:4,children:(0,t.jsxs)(E.k,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,t.jsx)(a.v4,{}),(0,t.jsx)(a.tU,{pagination:s})]})});b.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},b.propTypes={pagination:i.shape({page:i.number,pageCount:i.number,pageSize:i.number,total:i.number})};const Z=({headers:s,rows:l,onOpenModal:g})=>{const{formatMessage:o}=(0,j.Z)(),m=V(),d=({type:n,value:r,model:D})=>n==="date"?m(r):n==="action"?o({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:S(r)},{model:D}):r||"-";return(0,t.jsx)(x.p,{children:l.map(n=>(0,t.jsxs)(P.Tr,{...(0,a.X7)({fn:()=>g(n.id)}),children:[s.map(({key:r,name:D,cellFormatter:T})=>(0,t.jsx)(A.Td,{children:(0,t.jsx)(M.Z,{textColor:"neutral800",children:d({type:r,value:T?T(n[D]):n[D],model:n.payload?.model})})},r)),(0,t.jsx)(A.Td,{...a.UW,children:(0,t.jsx)(E.k,{justifyContent:"end",children:(0,t.jsx)(H.h,{onClick:()=>g(n.id),"aria-label":o({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${n.action} action`}),noBorder:!0,icon:(0,t.jsx)(oe.Z,{})})})})]},n.id))})};Z.defaultProps={rows:[]},Z.propTypes={headers:i.array.isRequired,rows:i.array,onOpenModal:i.func.isRequired};const I=({value:s,options:l,onChange:g})=>{const{formatMessage:o}=(0,j.Z)(),m=o({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return(0,t.jsx)(J.hQ,{"aria-label":m,value:s,onChange:g,children:l.map(({label:d,customValue:n})=>(0,t.jsx)(X.O,{value:n,children:d},n))})};I.defaultProps={value:null},I.propTypes={value:i.string,options:i.arrayOf(i.shape({label:i.string.isRequired,customValue:i.string.isRequired}).isRequired).isRequired,onChange:i.func.isRequired};const Y=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],de=({formatMessage:s,users:l,canReadUsers:g})=>{const o=Object.keys(z).map(d=>({label:s({id:`Settings.permissions.auditLogs.${d}`,defaultMessage:S(d)},{model:void 0}),customValue:d})),m=[{name:"action",metadatas:{customOperators:Y,label:s({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),customInput:I,options:o},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:s({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(g&&l){const d=r=>r.username?r.username:r.firstname&&r.lastname?s({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:r.firstname,lastname:r.lastname}):r.email,n=l.map(r=>({label:d(r),customValue:r.id.toString()}));return[...m,{name:"user",metadatas:{customOperators:Y,label:s({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:n,customInput:I},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return m},le=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:s=>s?s.displayName:""}],_e=()=>{const{formatMessage:s}=(0,j.Z)(),l=(0,O.v9)(c.s),{allowedActions:{canRead:g,canReadUsers:o}}=(0,a.ss)({...l.settings.auditLogs,readUsers:l.settings.users.read}),[{query:m},d]=(0,a.Kx)(),{auditLogs:n,users:r,isLoading:D,hasError:T}=re({canReadAuditLogs:g,canReadUsers:o});(0,a.go)();const U=de({formatMessage:s,users:r,canReadUsers:o}),W=s({id:"global.auditLogs",defaultMessage:"Audit Logs"}),K=le.map(y=>({...y,metadatas:{...y.metadatas,label:s(y.metadatas.label)}}));return T?(0,t.jsx)(G.A,{children:(0,t.jsx)($.D,{children:(0,t.jsx)(h.x,{paddingTop:8,children:(0,t.jsx)(a.Hn,{})})})}):(0,t.jsxs)(k.o,{"aria-busy":D,children:[(0,t.jsx)(a.SL,{name:W}),(0,t.jsx)(w.T,{title:W,subtitle:s({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),(0,t.jsx)(q.Z,{startActions:(0,t.jsx)(ee.F,{displayedFilters:U})}),(0,t.jsxs)($.D,{canRead:g,children:[(0,t.jsx)(a.tM,{contentType:"Audit logs",headers:K,rows:n?.results||[],withBulkActions:!0,isLoading:D,children:(0,t.jsx)(Z,{headers:K,rows:n?.results||[],onOpenModal:y=>d({id:y})})}),(0,t.jsx)(b,{pagination:n?.pagination})]}),m?.id&&(0,t.jsx)(Q,{handleClose:()=>d({id:null},"remove"),logId:m.id})]})},me=()=>{const s=(0,O.v9)(c.s);return(0,t.jsx)(a.O4,{permissions:s.settings.auditLogs.main,children:(0,t.jsx)(_e,{})})}},11266:(R,p,e)=>{e.d(p,{u:()=>c});var t=e(27279),a=e(94486),O=e(40464);function c(E={},M={}){const{id:u="",...h}=E,{get:L}=(0,a.kY)(),{data:_,isError:C,isLoading:v,refetch:f}=(0,O.useQuery)(["users",u,h],async()=>{const{data:{data:P}}=await L(`/admin/users/${u}`,{params:h});return P},M);return{users:t.useMemo(()=>{let P=[];return _&&("results"in _?Array.isArray(_.results)&&(P=_.results):P=[_]),P},[_]),pagination:t.useMemo(()=>(_&&"pagination"in _)??null,[_]),isLoading:v,isError:C,refetch:f}}},930:(R,p,e)=>{e.d(p,{O:()=>a});var t=e(71943);const a=t.Wx},51452:(R,p,e)=>{e.d(p,{Z:()=>O});var t=e(74081),a=e(85898);const O=({startActions:c,endActions:E})=>!c&&!E?null:(0,t.jsxs)(a.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,t.jsx)(a.k,{gap:2,wrap:"wrap",children:c}),(0,t.jsx)(a.k,{gap:2,shrink:0,wrap:"wrap",children:E})]})},31430:(R,p,e)=>{e.d(p,{O:()=>L});var t=e(74081),a=e(27279),O=e(19003),c=e(52185),E=e(78565);const M=()=>(0,t.jsx)(c.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,t.jsx)(E.Z,{variant:"pi",textColor:"neutral500",children:"/"})});M.displayName="Divider";var u=e(85898);const h=(0,O.default)(u.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:_})=>`calc(-1*${_.spaces[2]})`};
  }
`,L=({label:_,children:C,...v})=>{const f=a.Children.toArray(C);return(0,t.jsx)(c.x,{"aria-label":_,...v,children:(0,t.jsx)(h,{as:"ol",children:a.Children.map(f,(x,P)=>{const A=f.length>1&&P+1<f.length;return(0,t.jsxs)(u.k,{inline:!0,as:"li",children:[x,A&&(0,t.jsx)(M,{})]})})})})};L.displayName="Breadcrumbs"},40505:(R,p,e)=>{e.d(p,{$:()=>c});var t=e(74081),a=e(52185),O=e(78565);const c=({children:E,isCurrent:M=!1,...u})=>(0,t.jsx)(a.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,t.jsx)(O.Z,{variant:"pi",textColor:"neutral800",fontWeight:M?"bold":"normal","aria-current":M,...u,children:E})});c.displayName="Crumb"}}]);
