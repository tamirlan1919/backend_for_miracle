"use strict";(self.webpackChunknew_backend=self.webpackChunknew_backend||[]).push([[1895],{5560:(W,p,t)=>{t.d(p,{F:()=>u});var s=t(74081),D=t(27279),C=t(52185),M=t(51413),m=t(94486),O=t(22905),g=t(61020);const u=({displayedFilters:T})=>{const[L,f]=D.useState(!1),{formatMessage:U}=(0,g.Z)(),P=D.useRef(null),A=()=>{f(y=>!y)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.x,{paddingTop:1,paddingBottom:1,children:[(0,s.jsx)(M.z,{variant:"tertiary",ref:P,startIcon:(0,s.jsx)(O.Z,{}),onClick:A,size:"S",children:U({id:"app.utils.filters",defaultMessage:"Filters"})}),L&&(0,s.jsx)(m.J5,{displayedFilters:T,isVisible:L,onToggle:A,source:P})]}),(0,s.jsx)(m.W$,{filtersSchema:T})]})}},81895:(W,p,t)=>{t.d(p,{ProtectedAuditLogsListPage:()=>_t});var s=t(74081),D=t(81565),C=t(37386),M=t(23851),m=t(85898),O=t(62475),g=t(52185),u=t(78565),T=t(90529),L=t(93960),f=t(84428),U=t(66016),P=t(9465),A=t(2667),y=t(71943),K=t(930),J=t(1296),$=t(49969),X=t(796),G=t(34041),b=t(51452),l=t(94486),B=t(61020),N=t(59461),k=t(5560),Z=t(22037),w=t(31430),q=t(40505),V=t(40464),tt=t(33866),st=t(84207),j=t(70627),et=t(51447),at=t(50637),Et=t(27279),mt=t(64797),gt=t(85811),Dt=t(43433),Mt=t(98934),Ot=t(8175),Pt=t(15816),ct=t(97442),ut=t(13576),Lt=t(87830),ht=t(47184),vt=t(364),pt=t(71563),Ct=t(49204),Tt=t(47853),At=t(74919),ft=t(29206),Ut=t(75719),yt=t(6078),Bt=t(51943),Rt=t(55783),It=t(92249),xt=t(41942),Wt=t(22919),Kt=t(53915),jt=t(75041),St=t(30200),Ft=t(91379),$t=t(33299),Nt=t(33409),Zt=t(63645),Vt=t(7988),zt=t(7055),Qt=t(26757),Yt=t(58311),Ht=t(29510),Jt=t(16946),Xt=t(10124),Gt=t(69530),bt=t(86961),kt=t(51527),wt=t(19764),qt=t(42982),ts=t(26126);const z=()=>{const{formatDate:e}=(0,B.Z)();return _=>{const n=(0,tt.Z)(_),r=e(n,{dateStyle:"long"}),i=e(n,{timeStyle:"medium",hourCycle:"h24"});return`${r}, ${i}`}},Q={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},S=e=>Q[e]||e,nt=({handleClose:e,logId:d})=>{const{get:_}=(0,l.kY)(),n=(0,l.lm)(),r=async h=>{const{data:c}=await _(`/admin/audit-logs/${h}`);if(!c)throw new Error("Audit log not found");return c},{data:i,status:a}=(0,V.useQuery)(["audit-log",d],()=>r(d),{onError(){n({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),e()}}),o=z(),E=i&&"date"in i?o(i.date):"";return(0,s.jsxs)(D.P,{onClose:e,labelledBy:"title",children:[(0,s.jsx)(C.x,{children:(0,s.jsx)(w.O,{label:E,id:"title",children:(0,s.jsx)(q.$,{isCurrent:!0,children:E})})}),(0,s.jsx)(M.f,{children:(0,s.jsx)(it,{status:a,data:i,formattedDate:E})})]})},it=({status:e,data:d,formattedDate:_})=>{const{formatMessage:n}=(0,B.Z)();if(e==="loading")return(0,s.jsx)(m.k,{padding:7,justifyContent:"center",alignItems:"center",children:(0,s.jsx)(O.a,{children:"Loading content..."})});const{action:r,user:i,payload:a}=d;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.x,{marginBottom:3,children:(0,s.jsx)(u.Z,{variant:"delta",id:"title",children:n({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"})})}),(0,s.jsxs)(T.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0,children:[(0,s.jsx)(R,{actionLabel:n({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:n({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:S(r)},{model:a?.model})}),(0,s.jsx)(R,{actionLabel:n({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:_}),(0,s.jsx)(R,{actionLabel:n({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:i?.displayName||"-"}),(0,s.jsx)(R,{actionLabel:n({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:i?.id.toString()||"-"})]}),(0,s.jsx)(L.V,{value:JSON.stringify(a,null,2),disabled:!0,label:n({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})})]})},R=({actionLabel:e,actionName:d})=>(0,s.jsxs)(m.k,{direction:"column",alignItems:"baseline",gap:1,children:[(0,s.jsx)(u.Z,{textColor:"neutral600",variant:"sigma",children:e}),(0,s.jsx)(u.Z,{textColor:"neutral600",children:d})]}),ot=({pagination:e}={pagination:{page:1,pageCount:0,pageSize:50,total:0}})=>(0,s.jsx)(g.x,{paddingTop:4,children:(0,s.jsxs)(m.k,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,s.jsx)(l.v4,{}),(0,s.jsx)(l.tU,{pagination:e})]})}),F=({headers:e,rows:d,onOpenModal:_})=>{const{formatMessage:n}=(0,B.Z)(),r=z(),i=({type:a,value:o,model:E})=>a==="date"?r(o):a==="action"?n({id:`Settings.permissions.auditLogs.${o}`,defaultMessage:S(o)},{model:E}):o||"-";return(0,s.jsx)(f.p,{children:d.map(a=>(0,s.jsxs)(U.Tr,{...(0,l.X7)({fn:()=>_(a.id)}),children:[e?.map(({key:o,name:E,cellFormatter:h})=>{const c=a[E];return(0,s.jsx)(P.Td,{children:(0,s.jsx)(u.Z,{textColor:"neutral800",children:i({type:o,value:h?h(c):c,model:a.payload?.model})})},o)}),(0,s.jsx)(P.Td,{...l.UW,children:(0,s.jsx)(m.k,{justifyContent:"end",children:(0,s.jsx)(A.h,{onClick:()=>_(a.id),"aria-label":n({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${a.action} action`}),noBorder:!0,icon:(0,s.jsx)(st.Z,{})})})})]},a.id))})};F.defaultProps={rows:[]},F.propTypes={headers:j.array.isRequired,rows:j.array,onOpenModal:j.func.isRequired};const dt=({canReadAuditLogs:e,canReadUsers:d})=>{const{get:_}=(0,l.kY)(),{search:n}=(0,et.TH)(),r=(0,l.lm)(),[{query:i}]=(0,l.Kx)(),a={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:v=>r({type:"warning",message:v.message})},{users:o,isError:E,isLoading:h}=(0,at.g)({},{...a,enabled:d,staleTime:2*(1e3*60)}),{data:c,isLoading:I,isError:x}=(0,V.useQuery)(["auditLogs",n],async()=>{const{data:v}=await _("/admin/audit-logs",{params:i});return v},{...a,enabled:e});return{auditLogs:c,users:o,isLoading:h||I,hasError:x||E}},Y=({value:e,options:d,onChange:_}={value:void 0})=>{const{formatMessage:n}=(0,B.Z)(),r=n({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return(0,s.jsx)(y.hQ,{"aria-label":r,value:e,onChange:_,children:d?.map(({label:i,customValue:a})=>(0,s.jsx)(K.O,{value:a,children:i},a))})},H=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],rt=({formatMessage:e,users:d,canReadUsers:_})=>{const n=Object.keys(Q).map(i=>({label:e({id:`Settings.permissions.auditLogs.${i}`,defaultMessage:S(i)},{model:void 0}),customValue:i})),r=[{name:"action",metadatas:{customOperators:H,label:e({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),customInput:Y,options:n},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:e({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(_&&d){const i=o=>o.username?o.username:o.firstname&&o.lastname?e({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:o.firstname,lastname:o.lastname}):o.email,a=d.map(o=>({label:i(o),customValue:o.id.toString()}));return[...r,{name:"user",metadatas:{customOperators:H,label:e({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:a,customInput:Y},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return r},lt=()=>{const{formatMessage:e}=(0,B.Z)(),d=(0,N.v9)(Z.s),{allowedActions:{canRead:_,canReadUsers:n}}=(0,l.ss)({...d.settings?.auditLogs,readUsers:d.settings?.users.read||[]}),[{query:r},i]=(0,l.Kx)(),{auditLogs:a,users:o,isLoading:E,hasError:h}=dt({canReadAuditLogs:_,canReadUsers:n});(0,l.go)();const c=rt({formatMessage:e,users:o,canReadUsers:n}),I=e({id:"global.auditLogs",defaultMessage:"Audit Logs"}),x=[{name:"action",key:"action",metadatas:{label:e({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),sortable:!0}},{name:"date",key:"date",metadatas:{label:e({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),sortable:!0}},{key:"user",name:"user",metadatas:{label:e({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),sortable:!1},cellFormatter:v=>v?v.displayName:""}];return h?(0,s.jsx)(J.A,{children:(0,s.jsx)($.D,{children:(0,s.jsx)(g.x,{paddingTop:8,children:(0,s.jsx)(l.Hn,{})})})}):(0,s.jsxs)(X.o,{"aria-busy":E,children:[(0,s.jsx)(l.SL,{name:I}),(0,s.jsx)(G.T,{title:I,subtitle:e({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),(0,s.jsx)(b.Z,{startActions:(0,s.jsx)(k.F,{displayedFilters:c})}),(0,s.jsxs)($.D,{children:[(0,s.jsx)(l.tM,{contentType:"Audit logs",headers:x,rows:a?.results||[],withBulkActions:!0,isLoading:E,children:(0,s.jsx)(F,{headers:x,rows:a?.results||[],onOpenModal:v=>i({id:`${v}`})})}),a?.pagination&&(0,s.jsx)(ot,{pagination:a.pagination})]}),r?.id&&(0,s.jsx)(nt,{handleClose:()=>i({id:null},"remove"),logId:r.id})]})},_t=()=>{const e=(0,N.v9)(Z.s);return(0,s.jsx)(l.O4,{permissions:e.settings?.auditLogs?.main,children:(0,s.jsx)(lt,{})})}},31430:(W,p,t)=>{t.d(p,{O:()=>T});var s=t(74081),D=t(27279),C=t(19003),M=t(52185),m=t(78565);const O=()=>(0,s.jsx)(M.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,s.jsx)(m.Z,{variant:"pi",textColor:"neutral500",children:"/"})});O.displayName="Divider";var g=t(85898);const u=(0,C.default)(g.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:L})=>`calc(-1*${L.spaces[2]})`};
  }
`,T=({label:L,children:f,...U})=>{const P=D.Children.toArray(f);return(0,s.jsx)(M.x,{"aria-label":L,...U,children:(0,s.jsx)(u,{as:"ol",children:D.Children.map(P,(A,y)=>{const K=P.length>1&&y+1<P.length;return(0,s.jsxs)(g.k,{inline:!0,as:"li",children:[A,K&&(0,s.jsx)(O,{})]})})})})};T.displayName="Breadcrumbs"},40505:(W,p,t)=>{t.d(p,{$:()=>M});var s=t(74081),D=t(52185),C=t(78565);const M=({children:m,isCurrent:O=!1,...g})=>(0,s.jsx)(D.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,s.jsx)(C.Z,{variant:"pi",textColor:"neutral800",fontWeight:O?"bold":"normal","aria-current":O,...g,children:m})});M.displayName="Crumb"}}]);
